<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using beacons to out-compete googles indoor navigation - Christoffer Hauthorn</title>
  <meta name="description" content="We are doing more work to build reliable and accurate in-door navigation">

 
 	<!-- Toggable comment block for external scripts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
 	<!-- -->
	
  <link rel="stylesheet" href="/css/material.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://hauthorn.me/2019/02/09/beacon-wayfind">
  <link rel="alternate" type="application/rss+xml" title="Christoffer Hauthorn" href="http://hauthorn.me/feed.xml">
</head>


  <body>

    <div class="hauth-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100">

          <header class="hauth-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title"><a href="/">Christoffer Hauthorn</a></span>
          <div class="mdl-layout-spacer"></div>
        </div>
      </header>
      <div class="hauth-ribbon"></div>

      <main class="hauth-main mdl-layout__content">
        <div class="hauth-container mdl-grid">
          <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
          <div class="hauth-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
              <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Using beacons to out-compete googles indoor navigation</h1>
                <p class="post-meta mdl-color-text--grey-500"><time datetime="2019-02-09T11:35:00+01:00" itemprop="datePublished">Feb 9, 2019</time></p>
              </header>

              <div class="post-content" itemprop="articleBody">
                <p>In Emplate, we try to improve the shopping experience for the visitors. We‚Äôve done alot to improve the utility of the app while at home, but recent had more consumers that ask for wayfinding capabilities in the app.</p>

<p>Using the ‚ÄúOwn time‚Äù (4 hours every sprint that is free to be used on any project the employee deems interesting/worthy) provided to all employees at Emplate, I wanted to test the following hypothesis:</p>

<ol>
  <li><strong>Can I visualize my current location</strong> in a intuitive way? (wilst also conveying some of the inaccuracy that the solution has)</li>
  <li><strong>Is the tracking accurate enough</strong> that it might be used instead of existing solutions? (eg. Google Maps)</li>
  <li>Given our current knowledge of the layout at Storcenter Nord, <strong>can we provide turn-by-turn navigation?</strong></li>
</ol>

<h2 id="where-are-our-beacons-placed">Where are our beacons placed?</h2>
<div style="float: right; margin: 1em;">
<img src="/assets/images/emplate-wayfind/2019-01-17-beacons-located.jpg" alt="Beacons in Storcenter Nord" style="max-width: 320px; height auto;" />
<p class="img-text">Using the prototype our dev Mieszko built during his internship, <br />I located beacons in the mall.</p>
</div>
<p>We have bluetooth beacons placed at the entrances to the stores in the mall.
Using an app that one of our student programmers built during his internship here, I located the beacons on the map, and sent the exact locations to our system for use in the future.</p>

<p>The app is shown in the image to the right.</p>

<p>Once all beacons were located, I was ready to build my small prototype that would show my location based on the signal from the beacons to my phone.</p>

<p>By the way - locating and using the app to send the coordinates in SCN took about an hour. Now we just need to keep it up to date üòÇ</p>

<div style="clear: both;"></div>

<h2 id="emplate-wayfind">Emplate Wayfind</h2>
<p>I setup a simple app with Google Maps integrated in order to show the map of the mall (and of course to compete with Google for best location service).</p>

<p>Listening for the beacons is easily done using the SDK that our supplier <a href="https://developer.kontakt.io/mobile/android/sdk/">Kontakt.io</a> provides us.</p>

<p>Then there‚Äôs the hypothesis: <em>Can I visualize my current location in a intuitive way?</em></p>

<p>To get a sense of the data we ready from the sensors, I started displaying every beacon in sight, using opacity to show signal strength (used as a proxy to distance to the beacon).
This gives a sense of how many sensors the phone picks up at any given point in time, but leaves alot to the user to process. It‚Äôs probably better to go with a circle showing the approximate location of the user.</p>

<p>Another observation from testing: we rarely have good signal from more than 3 beacons at a time.</p>

<p>This informed the design:</p>

<ul>
  <li>Show a circle that encloses the 1-3 nearest beacons at any time.</li>
  <li>If only one beacon is in range:
    <ul>
      <li>Chose center of the circle to be the location of the beacon</li>
      <li>Radius of circle is <script type="math/tex">min(dist_b, 10)</script>, where <script type="math/tex">dist_b</script> is the distance to the beacon in meters</li>
    </ul>
  </li>
  <li>If there‚Äôs multiple beacons <script type="math/tex">B = \{b_1, b_2, \dots, b_k \}</script> in range:
    <ul>
      <li>Calculate simple centroid lat/lng: <script type="math/tex">lat = \frac{\sum_{b \in B} b_{lat}}{k}</script>, <script type="math/tex">lng = \frac{\sum_{b \in B} b_{lng}}{k}</script></li>
      <li>Let radius <script type="math/tex">r_{max}</script> equal to the distance of the farthest beacon</li>
      <li>Draw circle with center in the centroid <script type="math/tex">c</script> and radius <script type="math/tex">r_{max}</script></li>
    </ul>
  </li>
</ul>

<p>Images of the two visualizations:</p>

<div class="mdl-grid">
	<div class="mdl-cell mdl-cell--6-col">
		<img src="/assets/images/emplate-wayfind/pins-with-opacity.png" alt="Pins of nearby beacons" />
		<p class="img-text">Pins of beacons that the phone picks up</p>
	</div>
    <div class="mdl-cell mdl-cell--6-col">
		<img src="/assets/images/emplate-wayfind/circle-with-nearest.png" alt="Circle based on nearest beacons" />
		<p class="img-text">Using the nearest beacon to draw a circle around your location</p>
	</div>
</div>

<p>With this out of the way - here‚Äôs a screen recording of me walking along the outermost corridors of Storcenter Nord.</p>

<ol>
  <li>The blue circle is Google Maps using all the sensors of the phone to locate me.</li>
  <li>The orange is my prototype, only using bluetooth.</li>
</ol>

<iframe width="800" height="480" src="https://www.youtube-nocookie.com/embed/98t9eyD2JPE?rel=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<p>If you look closely in the video, my prototype had issues in some locations of the mall with a low density of beacons (left corridor), but Google had multiple instances of showing me ghost-walking through walls, and guessing I‚Äôm in a different corridor at times.</p>

<p>I‚Äôm feeling confident that the setup can be tweaked to yield better performance just using bluetooth, and obviously get even more accurate location if we use more sensors.</p>

              </div>

            </article>
          </div>
          <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>

          <!-- New row for post navigation -->
          <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
          <nav class="post-nav mdl-color-text--grey-50 mdl-cell mdl-cell--8-col">
            
              <a href="/2017/04/12/algorithm-engineering" class="nav-button">
                <button data-upgraded=",MaterialButton,MaterialRipple" class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                  <i class="material-icons">arrow_back</i>
                </button>
                Algorithm Engineering at AU
              </a>
            

            <div class="section-spacer"></div>

            
          </nav>
        </div>
                <footer class="hauth-footer mdl-mini-footer">
          <div class="mdl-mini-footer--left-section">
            <ul class="mdl-mini-footer--link-list">
              
              
              <li><a class="page-link" href="/about/">About</a></li>
              
              
              
              
              
              
              
              
            </ul>
          </div>
        </footer>
<script src="/js/material.min.js"></script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
    (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
            (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
            m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
    })(document, window, '//138.68.107.79:9000/tracker.js', 'fathom');
    fathom('set', 'siteId', 'IQDLX');
    fathom('trackPageview');
</script>
<!-- / Fathom -->
      </main>
    
    </div>

  </body>

</html>
